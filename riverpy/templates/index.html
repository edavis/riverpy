<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>River of News</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/default.css">
</head>
<body>

<div id="header" role="banner">
    <div class="hgroup">
      <select id="riverList" name="riverList" onChange="changeRiver(this)">
	{% for river in rivers %}
	  <option value="{{ river.name }}" data-url="/rivers/{{ river.name }}.js">{{ river.info.title }}</option>
	{% endfor %}
      </select>
    </div>
</div>

<div id="stream" role="main">
    <p class="notice">This website requires JavaScript.</p>
</div>

<div id="footer" role="contentinfo">
    <p>
        <a class="icon" href="http://cyber.law.harvard.edu/rss/rss.html"><img src="/images/rss.gif" width="65" height="59" alt="Love RSS!"></a>
	The fine print:
	Built using <a href="https://github.com/edavis/riverpy">riverpy</a>, written by <a href="https://github.com/edavis">Eric Davis</a>.
	Inspired by <a href="http://scripting.com/">Dave Winer</a> and his <a href="http://river2.newsriver.org/">River2</a> and <a href="http://riverjs.org/">river.js</a> projects.
	<a href="http://github.com/necolas/newsriver-ui/">Theme</a> by <a href="http://nicolasgallagher.com">Nicolas Gallagher</a>.
	Collaborative development on the <a href="https://groups.google.com/forum/#!forum/river-of-news">River Of News</a> mailing list by Martin Duffy, Shawn McCollum, Ken Booth, Daniel Bachhuber, and Havagan.
    </p>
</div>

{% raw %}
<script id="template" type="text/x-jquery-tmpl">
    <div id="stream-header">
        <a id="stream-view" href="#">Switch to collapsed view</a></li>
        <p id="stream-updated">Updated <span class="time">${dateFormat(metadata.whenGMT, 'timeDate')}</span></p>
    </div>

    <a id="stream-notice" href="#"></a>

    <div id="stream-items">

    {{each(f,feed) updatedFeeds.updatedFeed}}

        <div class="section">
            <div class="header">
                <h2>
                    {{if websiteUrl}}<a href="${websiteUrl}">{{/if}}<img class="icon" src="${River.methods.getFavicon(websiteUrl)}" alt="">{{if websiteUrl}}</a>{{/if}}
                    {{if websiteUrl}}<a href="${websiteUrl}">{{/if}}${feedTitle}{{if websiteUrl}}</a>{{/if}}
                    (<a href="${feedUrl}" title="Subscribe to ${feedTitle}">Feed</a>)
                </h2>
                <span class="time">${dateFormat(whenLastUpdate, 'timeDate')}</span>
            </div>

        {{each(i,item) item}}

            <div class="article" id="${item.id}">
                <div class="header">
                    <h3>
                    {{if item.permaLink || item.link}}<a href="${item.permaLink || item.link}" rel="external" target="_blank">{{/if}}
                    {{if item.title}}
                        ${item.title}
                    {{else}}
                        ${River.methods.getText(item.body)}
                    {{/if}}
                    {{if item.permaLink || item.link}}</a>{{/if}}
                    </h3>
                </div>

            {{if item.title && item.body}}
                <div class="description">

                {{each(t,thumbnail) item.thumbnail}}
                    <img class="thumbnail" src="${thumbnail.url}" width="${thumbnail.width}" height="${thumbnail.height}" alt="">
                {{/each}}

                    ${River.methods.getText(item.body)}
                </div>
            {{/if}}

                <div class="footer">
                    <span class="time">${River.methods.prettyDate(item.pubDate)}</span>
                    <ul class="actions">
                    {{if item.comments}}
                        <li><a href="${item.comments}" rel="external nofollow" target="_blank">Comment</a></li>
                    {{/if}}
                    {{each(e,enclosure) item.enclosure}}
                        <li class="enclosure ${River.methods.getMediaType(enclosure.type)}"><a href="${enclosure.url}">Download enclosure (${enclosure.type}, ${River.methods.getEnclosureSize(enclosure.length)})</a></li>
                    {{/each}}
                    </ul>
                </div>
            </div>

        {{/each}}

        </div>

    {{/each}}

    </div>
</script>
{% endraw %}
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.js"></script>
<script src="/js/jquery.tmpl.min.js"></script>
<script src="/js/custom.js"></script>
<script>
 function updateRiver (url) {
   River.generate.loading();
   River.generate.init(url, 'onGetRiverStream');
   River.generate.viewToggle();
 }

 function updateTitle (title) {
   document.title = title + " | River of News";
 }

 function changeRiver (element) {
   var $selected = $(element).find(':selected');
   updateRiver($selected.data('url'));
   updateTitle($selected.text());
 }

 $(function() {
   var $initial = $("#riverList").children().first();
   var initialUrl = $initial.data('url');
   updateRiver(initialUrl);
 });
</script>

</body>
</html>
